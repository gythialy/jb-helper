package license

import (
	"encoding/json"
	"testing"

	"github.com/gythialy/jb-helper/internal/model"
)

func TestGenerateLicense(t *testing.T) {
	dataStr := `{"licenseId":"H8DM8DXV2M","licenseeName":"Mercury Labs","assigneeName":"user","assigneeEmail":"","licenseRestriction":"","checkConcurrentUse":false,"products":[{"code":"PRAINBOWBRACKET","fallbackDate":"2026-10-05","paidUpTo":"2026-10-05","extended":false}],"metadata":"0120230102PPAA013009","hash":"41472961/0:1563609451","gracePeriodDays":7,"autoProlongated":true,"isAutoProlongated":true}`
	license := model.License{}
	if err := json.Unmarshal([]byte(dataStr), &license); err != nil {
		t.Fatal(err)
	}

	if license, err := GenerateLicense(&license); err == nil {
		t.Log(license)
	} else {
		t.Fatal(err)
	}
	// H8DM8DXV2M-eyJsaWNlbnNlSWQiOiJIOERNOERYVjJNIiwibGljZW5zZWVOYW1lIjoiTWVyY3VyeSBMYWJzIiwiYXNzaWduZWVOYW1lIjoidXNlciIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBSQUlOQk9XQlJBQ0tFVCIsImZhbGxiYWNrRGF0ZSI6IjIwMjYtMTAtMDUiLCJwYWlkVXBUbyI6IjIwMjYtMTAtMDUiLCJleHRlbmRlZCI6ZmFsc2V9XSwibWV0YWRhdGEiOiIwMTIwMjMwMTAyUFBBQTAxMzAwOSIsImhhc2giOiI0MTQ3Mjk2MS8wOjE1NjM2MDk0NTEiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6dHJ1ZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOnRydWV9-RkZ5NfjLO9qiyK0ZgBun8sqrF8swuwlqApPZ2FOjSUNTYa1a5vCUZ6F0YfrjBpGxiQou3H+bTxGyk+p2Ot+Ml/cmU7S5bGNgxtc/gJ5ve7uZPgQfhki8ooUv4vGAXXw7TJC3dXzjCdl6bZCDa/HFE5mDGTtdTc7q4GNOpn/v26MCSuACMdYl494h61w8bFj0qHPvGiujTsPeJs0Oq5sh4RygizCHpiq4vqFNEAYI1d3WIhwu1+Nj0NbqLG5qW4nfGLhbobcQrGEv9DnMFZt13ovJtPPsR/6qv4QUcbbzq5YtCe4zak7s6dQzunToiR7yJ3ZNdVx+bj5inwY5q7B2Wg+T+SNDTuY6H5gEKUewJBi1vePUjy8mdMHqDtTdE1fKxu0LlIqhX7J8E1+uw4bNK2GDD4YS8uZcVP4ZpFppZ6moantpgqjf00zcOyetB+JbvoUplcy32oviRRfeG7Ox48SrU97JutlhjDg0WkB9IKa6YZ91ybJGD8O4Gqoohsj+B6Q6lrHBXzVAPyIKGZGy0zVJ0pw2ch3kf3SRbi22BMiwMn/X6LQ3XOoaO9s7Ufm6lfPkpAu4d0k4wTJekMdl3FaUbtQKBLKYfyCN6ywBygXGSW01hq1K0IcaLJkiZrLW7HYWYTG6cS7EIZ3oUynd4PRjufNDoxDN7H8ReTCxK4c=-MIIEuDCCAqCgAwIBAgIQehDN5nmBiuq8RGGmzOHc/zANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDEw1KZXRQcm9maWxlIENBMB4XDTI0MTAwNDAzMjAzM1oXDTM0MTAwMzAzMjAzM1owGDEWMBQGA1UEAxMNSmV0UHJvZmlsZSBDQTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAOF8P6DPrWLldByoybs6rY3j09FMloRICY17aIECLYAmqPDUUAi7I9uxwMunFMXwcQVEUng3odh2FgZDAFpbjMzgdPIaKT97S78mnf/nTI0wysHH04vRzeehfW9XX7vtjca1PmMYpuLhvW2al51xODxx5zipzNtAneLsaejCzazR0JJLKoWe7FV2NWdFGzxRD0AUWSMjqn94uE6iu3Ci98rTxeHabVT7TzswWPNKUsKiVzVbHbneoTl4UY5RQWJp7UfbRSCQKHbFGuTI7dDPJyLNruevLKDbK/LW+yem2JeTb/2c6JRgQZZZK7IqRhaG7zK3TQsjmQmum5a7WD539lx78xKm1pKjLimveOwXDFfaWSHWy5zR2MEXQxCNwbRPB2WRdt2hoqgcaKn5LeizDSaCwPJYOKXJFwTonn5RXqhVmsMKkxZPss14+2VzbP/B2M/N4i6pyd+uYWHYF+myX9yfPbkcCA5tTfAwEr2LH5iFlsv3WWS9sAkHl8vpndiNOXFzVPB0iPQSQghgFpk85OMhK0DnOsS2zrp+IBPuNw586V0GZrWuWy8jrIStur38UMrz2wAWwEXcRCIRkmUlHgRyuJn4CUT0CqHcAegN/Mrpsf4XQRRPxb8w4k7yL5JpPEtajh+Sb5a7i6xynljIiO4+r4Ax84R6a4LQxgS3vVv5AgMBAAEwDQYJKoZIhvcNAQELBQADggIBAEe2q6YsTPseWqU8av7d6VZH+Rff8l5vYQSPgdAGLNVGW7R2V8t+1drp7NQepFaRkGkivUcjNKqa5sDwWUlPXCcboVdjsu1+SXxvb0G6VqI3+bCmd7oJtiewpOOxVek/VzNifKsJurbA9OUFrqkbgkqshxSWi/nAVEsgft5dRu+dziM8847Zdc4omG8er0ei3gWK1ag7YUeodToba1VtrUS+aUtFIZrnPFW1wlhyoUAtxKa57v/4kzhqSggbrVSvkprvoIJxVYgjoIt28Q3Nx09qmY68cQP7ebhL3a4GltUd5isls1FHEJJaZUiroI2XQ7Wc+a/SrdeoirdAjadWJzF9A0PU5+3DmGoEwQZliwWJg+/xCubROtUowWJqUXU9tqLSjOwNVJzpmTxv1asrvgYm/dTHkuxU7OTBV80Xd6OJFpjOvWRsvE5XBvIFytCxOsQUZDlaW7arZkkvYOw0cN0vMTlUHRiBcheCq76JPNx/u897TKRIXYeTQEyCcAKKIvi+YGpz15ALITNAUpJP+bz09r//XflLX/bDwoKa6nq6k02xV6k1N3iDUyfLOnGefzplvQU9cW4wswGdhZFc0eUVSGtdtcD9+XWm/y6wo0faHGE5gBKPvlhe+KyGr+GeDtAshtBiBd79/HVODfplxnLUdY9Tf+fBKDxCW0yk05Mo
}
